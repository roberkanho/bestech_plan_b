

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Working with the Entity Resolver &mdash; The Conversational AI Playbook 4.0.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'4.0.2',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/custom.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Working with the Language Parser" href="parser.html" />
    <link rel="prev" title="Working with the Role Classifier" href="role_classifier.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Conversational AI Playbook
          

          
          </a>

          
            
            
              <div class="version">
                4.0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/introduction_to_conversational_applications.html">Introduction to Conversational Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/approaches_for_building_conversational_applications.html">Different Approaches for Building Conversational Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/anatomy_of_a_conversational_ai_interaction.html">Anatomy of a Conversational AI Interaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/introducing_mindmeld_workbench.html">Introducing MindMeld</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/key_concepts.html">Key Concepts</a></li>
</ul>
<p class="caption"><span class="caption-text">Step-by-Step Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/00_overview.html">Building a Conversational Interface in 10 Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/01_select_the_right_use_case.html">Step 1: Select the Right Use Case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/02_script_interactions.html">Step 2: Script Your Ideal Dialogue Interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/03_define_the_hierarchy.html">Step 3: Define the Domain, Intent, Entity, and Role Hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/04_define_the_dialogue_handlers.html">Step 4: Define the Dialogue State Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/05_create_the_knowledge_base.html">Step 5: Create the Knowledge Base</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/06_generate_representative_training_data.html">Step 6: Generate Representative Training Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/07_train_the_natural_language_processing_classifiers.html">Step 7: Train the Natural Language Processing Classifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/08_configure_the_language_parser.html">Step 8: Configure the Language Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/09_optimize_question_answering_performance.html">Step 9: Optimize Question Answering Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/10_deploy_to_production.html">Step 10: Deploy Trained Models</a></li>
</ul>
<p class="caption"><span class="caption-text">Blueprint Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../blueprints/overview.html">MindMeld Blueprints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blueprints/food_ordering.html">Food Ordering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blueprints/video_discovery.html">Video Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blueprints/home_assistant.html">Home Assistant</a></li>
</ul>
<p class="caption"><span class="caption-text">Integrations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../integrations/webex_teams.html">Webex Teams Integration</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About this guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Platform Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessor.html">Working with the Preprocessor</a></li>
<li class="toctree-l1"><a class="reference internal" href="nlp.html">Working with the Natural Language Processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="domain_classifier.html">Working with the Domain Classifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="intent_classifier.html">Working with the Intent Classifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="entity_recognizer.html">Working with the Entity Recognizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="lstm.html">Using LSTM for Entity Recognition</a></li>
<li class="toctree-l1"><a class="reference internal" href="role_classifier.html">Working with the Role Classifier</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Working with the Entity Resolver</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#understanding-the-entity-resolver">Understanding the entity resolver</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prepare-data-for-the-entity-resolver">Prepare data for the Entity Resolver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generate-entity-mapping-files">Generate entity mapping files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generate-synonyms">Generate synonyms</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#train-the-entity-resolver">Train the entity resolver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#train-the-resolver-alone">Train the resolver alone</a></li>
<li class="toctree-l3"><a class="reference internal" href="#train-the-resolver-by-building-the-nlp-pipeline">Train the resolver by building the NLP pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#about-the-entityresolver-fit-method">About the <cite>EntityResolver.fit()</cite> method</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#run-the-entity-resolver">Run the entity resolver</a></li>
<li class="toctree-l2"><a class="reference internal" href="#consider-context-aware-entity-resolution">Consider context-aware entity resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#about-the-exact-match-text-similarity-model">About the Exact Match text similarity model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="parser.html">Working with the Language Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_features.html">Working with User-Defined Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="kb.html">Working with the Knowledge Base and Question Answerer</a></li>
<li class="toctree-l1"><a class="reference internal" href="dm.html">Working with the Dialogue Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="voice.html">Dealing with Voice Inputs</a></li>
</ul>
<p class="caption"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../versions/changes.html">Recent Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versions/history.html">Package History</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../internal/api_reference.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Conversational AI Playbook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Working with the Entity Resolver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/userguide/entity_resolver.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

/* nice headers on first paragraph of info/warning boxes */
.admonition .first {
    margin: -12px;
    padding: 6px 12px;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1;
    display: block;
}
.admonition.warning .first {
    background: #f0b37e;
}
.admonition.note .first {
    background: #6ab0de;
}
.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="working-with-the-entity-resolver">
<h1>Working with the Entity Resolver<a class="headerlink" href="#working-with-the-entity-resolver" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="architecture.html#arch-entity-model"><span class="std std-ref">Entity Resolver</span></a></p>
<blockquote>
<div><ul class="simple">
<li>is run as the fifth step in the <a class="reference internal" href="nlp.html#instantiate-nlp"><span class="std std-ref">natural language processing pipeline</span></a></li>
<li>uses information retrieval techniques to perform entity resolution (also called entity linking)</li>
<li>is trained per entity type, using an entity mapping file that contains synonyms for all possible entity instantiations</li>
</ul>
</div></blockquote>
<p>Every Workbench app has one entity resolver for every entity type. The mapping files are found in their respective entity folders.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is an in-depth tutorial to work through from start to finish. Before you begin, read the <a class="reference internal" href="../index.html#quickstart"><span class="std std-ref">Step-by-Step Guide</span></a>, paying special attention to the <a class="reference internal" href="../quickstart/07_train_the_natural_language_processing_classifiers.html#entity-resolution"><span class="std std-ref">Entity Resolution</span></a> section.</p>
</div>
<div class="section" id="understanding-the-entity-resolver">
<h2>Understanding the entity resolver<a class="headerlink" href="#understanding-the-entity-resolver" title="Permalink to this headline">¶</a></h2>
<p>In NLP literature, entity resolution or <a class="reference external" href="https://en.wikipedia.org/wiki/Entity_linking">entity linking</a> is the problem of identifying all terms that refer to the same real-world entity.</p>
<p>In Workbench, two different kinds of entities require resolution:</p>
<blockquote>
<div><ul class="simple">
<li><em>entities that refer to an object</em> in the knowledge base —&nbsp;these resolve to an <em>id, canonical name</em> pair consisting of the unique ID of the object in the knowledge base, and the <a class="reference internal" href="../intro/key_concepts.html#term-canonical-name"><span class="xref std std-term">canonical name</span></a> for the object, respectively</li>
<li><em>entities that refer to a property</em> of an object in the knowledge base —&nbsp;these resolve to a <em>id, canonical name</em> pair consisting of an optional user-specified ID and the <a class="reference internal" href="../intro/key_concepts.html#term-canonical-name"><span class="xref std std-term">canonical name</span></a> for the property respectively</li>
</ul>
</div></blockquote>
<p>For example, in a food-ordering app:</p>
<blockquote>
<div><ul class="simple">
<li>the entity resolver could determine that the entity ‘lemon bread’ signifies the ‘Iced Lemon Pound Cake’ on the Buttery Bakery menu, which is represented by the object whose unique ID is ‘4567.’ The result is that ‘lemon bread’ resolves to the dictionary <code class="docutils literal"><span class="pre">{</span> <span class="pre">'id':</span> <span class="pre">'4567',</span> <span class="pre">cname:</span> <span class="pre">'Iced</span> <span class="pre">Lemon</span> <span class="pre">Pound</span> <span class="pre">Cake'</span> <span class="pre">}</span></code>.</li>
<li>the entity ‘Siamese’ could resolve to the dictionary <code class="docutils literal"><span class="pre">{</span> <span class="pre">'id':</span> <span class="pre">None,</span> <span class="pre">cname:</span> <span class="pre">'Thai'</span> <span class="pre">}</span></code>. Multiple ‘restaurant’ objects could have that property/value combination. The property has no ID, but in the ‘restaurant’ index in the knowledge base, every object does have an ID. See the <a class="reference external" href="https://mindmeld.com/docs/blueprints/food_ordering.html#knowledge-base">Food Ordering blueprint</a>.</li>
</ul>
</div></blockquote>
<p>This discussion assumes that the app has a knowledge base. For apps with no knowledge base, entity resolution is similar but no objects are involved.</p>
<p>The Entity Resolver has two main tools at its disposal:</p>
<ol class="arabic">
<li><p class="first"><strong>Synonym lists</strong></p>
<blockquote>
<div><p>Even entities of the same type and with the same canonical name can differ in their properties. For example, there could be two dishes whose canonical name is ‘House Salad,’ but they are from different restaurants, and while one is a ‘spinach salad,’ the other is a ‘tropical fruit salad.’ For these two entities, then, the <code class="docutils literal"><span class="pre">restaurant</span></code> and <code class="docutils literal"><span class="pre">salad_type</span></code> properties would differ. Workbench captures these differences in <em>synonym lists</em> (described in the next section) which the entity resolver uses to select the most appropriate result for a given query.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>A numeric sort factor</strong></p>
<blockquote>
<div><p>Textual similarity is the primary factor in entity resolution. When many entities are highly similar textually, Workbench uses a numeric value called the <em>sort factor</em> to boost the likelier ones. The sort factor means different things in different applications. A food ordering application might use restaurant ratings, while a music discovery application might use number of listens for an album, and so on.</p>
<p>For music discovery, the sort factor could help the app choose between two different songs, sung by different artists, that have the same song title. For food ordering application, the sort factor could help the app choose between multiple ‘Pad Thai’ dishes, each from a different restaurant, and each with a different ID in the Knowledge Base.</p>
</div></blockquote>
</li>
</ol>
<p>These tools help when the knowledge base has multiple unique entries with different IDs but the same canonical name, and the entity resolver needs a way to make the best choice among them.</p>
<p>In the knowledge base, multiple objects can have the same canonical name, but every object has a unique ID. When an entity resolves to an object ID, the developer can use that ID directly to perform actions like querying the knowledge base, displaying results, or making an API call to place an order.</p>
<p>An example of an entity type that works this way is the <code class="docutils literal"><span class="pre">dish</span></code> entity type for the food ordering use case. The entity ‘stir-fried Thai noodles,’ an entity of type <code class="docutils literal"><span class="pre">dish</span></code>, might resolve to the object <code class="docutils literal"><span class="pre">{cname:</span> <span class="pre">&quot;Pad</span> <span class="pre">Thai&quot;,</span> <span class="pre">id:</span> <span class="pre">123}</span></code>. Then the developer can use the dish ID, <code class="docutils literal"><span class="pre">123</span></code>, to perform desired actions.</p>
<p>When an entity resolves to a particular text value (contained in the cname field) for an object property, the developer can simply treat the entity as a name for use in natural language responses or in filtering results.</p>
<p>For example, in food ordering, the <code class="docutils literal"><span class="pre">cuisine</span></code> entity type does not correspond to any objects in the knowledge base. But resolving to the cuisine type ‘Thai’ allows the developer to do a filter search on the cuisine attribute of the <code class="docutils literal"><span class="pre">restaurant</span></code> objects to obtain a list of relevant restaurants. In this scenario, there is no need for the entity resolver to include an ID in the resolution value.</p>
<p>The entity resolver is trained using <em>entity mapping files</em>, described in the next section.</p>
</div>
<div class="section" id="prepare-data-for-the-entity-resolver">
<h2>Prepare data for the Entity Resolver<a class="headerlink" href="#prepare-data-for-the-entity-resolver" title="Permalink to this headline">¶</a></h2>
<p>The most important task when you are developing a production-quality entity resolver is to collect a high-quality and comprehensive set of synonyms, and place those synonyms into entity mapping files, which is where Workbench can use them.</p>
<p>This section explains how entity mapping files and synonym files are structured, and how they work. Each sub-section concludes with instructions for generating the files.</p>
<p>Entity mapping files come first, since they provide the framework into which the synonyms fit.</p>
<div class="section" id="generate-entity-mapping-files">
<h3>Generate entity mapping files<a class="headerlink" href="#generate-entity-mapping-files" title="Permalink to this headline">¶</a></h3>
<p>Every Workbench app has an entity mapping file for each entity type.</p>
<p>An entity mapping file is a JSON file containing a dictionary whose purpose is to provide information about entities of the given type, and, where applicable, about how the entity type corresponds to a knowledge base object type. Entity mapping files are used to train the entity resolver.</p>
<p>At the top level, the entity mapping file has the three key/value pairs described in the table below.</p>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="2%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>parameter name</strong></td>
<td><strong>JSON field name</strong></td>
<td><strong>description</strong></td>
</tr>
<tr class="row-even"><td>entities</td>
<td><code class="docutils literal"><span class="pre">entities</span></code></td>
<td>A list of dictionaries, one for each possible real-world instance of the given entity type. See the table below for more details.</td>
</tr>
<tr class="row-odd"><td>knowledge base index name (optional)</td>
<td><code class="docutils literal"><span class="pre">kb_index_name</span></code></td>
<td>Name of the knowledge base index that contains information about this entity type. For example, information about the <code class="docutils literal"><span class="pre">dish</span></code> entity type may be stored in the objects in the <code class="docutils literal"><span class="pre">menu_items</span></code> index in the knowledge base.</td>
</tr>
<tr class="row-even"><td>knowledge base field name (optional)</td>
<td><code class="docutils literal"><span class="pre">kb_field_name</span></code></td>
<td>Name of the knowledge base field name that this entity type corresponds to. In other words, the entity text is contained in this field of a knowledge base object. For example, the text span captured in entity type <code class="docutils literal"><span class="pre">dish</span></code> describes the dish name in a user’s request and corresponds to the knowledge base text field <code class="docutils literal"><span class="pre">name</span></code> of the index <code class="docutils literal"><span class="pre">menu_items</span></code>. The knowledge base index and the knowledge base field parameters together describe how the NLP entity type corresponds to a knowledge base object type. When specified, the synonym whitelist for such knowledge base-linked entities is accessible by the Question Answerer. It can then leverage that information when formulating knowledge base filtered searches to disambiguate entities with custom constraints. See <a class="reference internal" href="#consider-context-aware-entity-resolution">Consider context-aware entity resolution</a> section</td>
</tr>
</tbody>
</table>
<p>One key, <code class="docutils literal"><span class="pre">entities</span></code>, has a list of dictionaries for its value. Each of those dictionaries refers to a single real-world entity, and has the attributes described in the table below.</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="5%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>canonical name</td>
<td><code class="docutils literal"><span class="pre">cname</span></code></td>
<td>The standardized or official name of the real-world entity. Textual similarity with the canonical name is one of the primary factors used in entity resolution.</td>
</tr>
<tr class="row-even"><td>unique ID</td>
<td><code class="docutils literal"><span class="pre">id</span></code></td>
<td>An optional unique identifier. If there are multiple entries in the mapping file with the same canonical name, the ID is necessary for uniquely identifying each entry. If an entity has a corresponding entry in the Knowledge Base, this ID should be the same as the ID of the KB entry. You can then use the resolved ID to query the KB for the appropriate entry.</td>
</tr>
<tr class="row-odd"><td>whitelist</td>
<td><code class="docutils literal"><span class="pre">whitelist</span></code></td>
<td>A list of synonyms. The whitelist is the most important component of the entity mapping file, because it allows the resolver to consistently resolve to a given entity that is often referred to by different terms.</td>
</tr>
<tr class="row-even"><td>sort factor (optional)</td>
<td><code class="docutils literal"><span class="pre">sort_factor</span></code></td>
<td>An optional numeric value. Entities with a higher sort factor will be ranked above those with a lower value and similar textual similarity.</td>
</tr>
</tbody>
</table>
<p>In the following excerpt of an entity mapping file from the food ordering blueprint, <code class="docutils literal"><span class="pre">dish</span></code> is an entity type, and each dictionary in the entity mapping file refers to a dish that users can order.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;kb_index_name&quot;</span><span class="o">:</span> <span class="s2">&quot;menu_items&quot;</span><span class="p">,</span>
  <span class="s2">&quot;kb_field_name&quot;</span><span class="o">:</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
  <span class="s2">&quot;entities&quot;</span><span class="o">:</span> <span class="p">[</span>

    <span class="p">{</span>
        <span class="s2">&quot;cname&quot;</span><span class="o">:</span> <span class="s2">&quot;Baigan Bharta&quot;</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;B01DN55TFO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;whitelist&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;Mashed eggplant and spiced tomato&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Specialty Spiced Eggplant Curry&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Seasoned Roasted Eggplant Mash&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Eggplant curry&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Spicy roasted eggplant dish&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;sort_factor&quot;</span><span class="o">:</span> <span class="mf">3.5</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;cname&quot;</span><span class="o">:</span> <span class="s2">&quot;Keema Naan&quot;</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;B01DN56EN0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;whitelist&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;keema stuffed naan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lamb naan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lamb stuffed naan&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;sort_factor&quot;</span><span class="o">:</span> <span class="mf">4.2</span>
    <span class="p">},</span>
    <span class="p">...</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Create an entity mapping file for each entity type in your app. When you first create them, the <code class="docutils literal"><span class="pre">whitelist</span></code> property of each entity object will have an empty list as its value. In the next section, you will populate that list with synonyms.</p>
<p>Save each entity mapping file as <code class="docutils literal"><span class="pre">mapping.json</span></code> in the corresponding entity folder. For example, the <code class="docutils literal"><span class="pre">mapping.json</span></code> file for the <code class="docutils literal"><span class="pre">category</span></code> entity should exist in the following location:</p>
<a class="reference internal image-reference" href="../_images/food_ordering_directory3.png"><img alt="../_images/food_ordering_directory3.png" class="align-center" src="../_images/food_ordering_directory3.png" style="width: 300px;" /></a>
</div>
<div class="section" id="generate-synonyms">
<h3>Generate synonyms<a class="headerlink" href="#generate-synonyms" title="Permalink to this headline">¶</a></h3>
<p>Synonyms enable the resolver to consistently resolve to an entity that users refer to using varied language. You can generate synonyms in-house, or crowdsource them from a service like Mechanical Turk. For some use cases, existing synonym data sets may be available.</p>
<p>To ensure that you get high-quality synonyms, observe the following guidelines:</p>
<ol class="arabic simple">
<li>The best synonyms are textually different but semantically similar. For example, <em>beef rice bowl</em> as a synonym for <em>gyudon</em>.</li>
<li>Include synonyms that are common alternate names for a given entity. For example, <em>phone</em> as a synonym for <em>cell</em>.</li>
<li>Add synonyms that include any useful information that more generic canonical names lack. For example, <em>Spinach Tomato Salad</em> would be a good synonym for <em>House Salad</em>.</li>
<li>Synonyms should be commonplace enough to be used in a conversational setting. Avoid contrived-sounding synonyms. For example, <em>cinnamon bun</em> may be a good synonym for <em>cinnamon roll</em>, but <em>cinnamon sugar sprinkled yeast-leavened dough in spiral form</em> would not be.</li>
<li>Don’t worry about generating exhaustive lists of possible misspellings or pluralization. The resolver will handle those cases.</li>
</ol>
<p>Create the synonyms and make them available to your Workbench app, going entity type by entity type. The general process to follow (subject to refinement and even some automation) is this:</p>
<ol class="arabic">
<li><p class="first">Choose an entity type</p>
</li>
<li><p class="first">Open the <code class="docutils literal"><span class="pre">mapping.json</span></code> file for the entity type in a text editor</p>
<blockquote>
<div><ol class="loweralpha simple">
<li>Choose a target entity from <code class="docutils literal"><span class="pre">entities</span></code> listed in the file</li>
<li>Locate the <code class="docutils literal"><span class="pre">whitelist</span></code> key in the dictionary that represents the target entity</li>
<li>Create synonyms for the target entity</li>
<li>Add each synonym to the list which is the value for <code class="docutils literal"><span class="pre">whitelist</span></code></li>
<li>Choose a new target entity (continue until you have covered all the entities for the entity type)</li>
</ol>
</div></blockquote>
</li>
<li><p class="first">Choose a new entity type (stop when you have covered all the entity types for the app)</p>
</li>
</ol>
</div>
</div>
<div class="section" id="train-the-entity-resolver">
<h2>Train the entity resolver<a class="headerlink" href="#train-the-entity-resolver" title="Permalink to this headline">¶</a></h2>
<p>The Entity Resolver uses the <a class="reference external" href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a> full-text search and analytics engine for information retrieval. This is required by the advanced text similarity model Workbench uses by default. Once Elasticsearch is up and running, no configuration needed is needed within Workbench. To learn how to set up Elasticsearch, see the <a class="reference internal" href="getting_started.html"><span class="doc">Getting Started guide</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you choose not to use Elasticsearch (not recommended), Workbench provides a simple baseline version of entity resolution as a fallback. See <a class="reference internal" href="#exact-match"><span class="std std-ref">About the Exact Match text similarity model</span></a>.</p>
</div>
<p>Once all of the entity mapping files are generated, you can either (1) train the resolver as a standalone component, or (2) build the whole NLP pipeline, which trains the resolver along with the other components.</p>
<div class="section" id="train-the-resolver-alone">
<h3>Train the resolver alone<a class="headerlink" href="#train-the-resolver-alone" title="Permalink to this headline">¶</a></h3>
<p>To train the resolver as a standalone component, adapt the following snippet to the particulars of your app:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mmworkbench</span> <span class="kn">import</span> <span class="n">configure_logs</span><span class="p">;</span> <span class="n">configure_logs</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">mmworkbench.components.nlp</span> <span class="kn">import</span> <span class="n">NaturalLanguageProcessor</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="n">NaturalLanguageProcessor</span><span class="p">(</span><span class="n">app_path</span><span class="o">=</span><span class="s1">&#39;food_ordering&#39;</span><span class="p">)</span>
<span class="n">nlp</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="s1">&#39;ordering&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">intents</span><span class="p">[</span><span class="s1">&#39;build_order&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">er</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="s1">&#39;ordering&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">intents</span><span class="p">[</span><span class="s1">&#39;build_order&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s1">&#39;dish&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">entity_resolver</span>
<span class="n">er</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="train-the-resolver-by-building-the-nlp-pipeline">
<h3>Train the resolver by building the NLP pipeline<a class="headerlink" href="#train-the-resolver-by-building-the-nlp-pipeline" title="Permalink to this headline">¶</a></h3>
<p>Build the NLP pipeline using <code class="xref py py-meth docutils literal"><span class="pre">NaturalLanguageProcessor.build()</span></code>. Among its other tasks, this fits the resolver. When you run <code class="xref py py-meth docutils literal"><span class="pre">NaturalLanguageProcessor.process()</span></code>, the NLP pipeline includes the resolved entities in its results.</p>
</div>
<div class="section" id="about-the-entityresolver-fit-method">
<h3>About the <cite>EntityResolver.fit()</cite> method<a class="headerlink" href="#about-the-entityresolver-fit-method" title="Permalink to this headline">¶</a></h3>
<p>When <code class="xref py py-meth docutils literal"><span class="pre">EntityResolver.fit()</span></code> method is run for the first time, Workbench creates the Elasticsearch index and uploads all the objects. How long this takes depends on the size of your data, your network speed, and whether your code and Elasticsearch server are running on the same machine.</p>
<p>For the sake of speed, subsequent calls to <code class="xref py py-meth docutils literal"><span class="pre">EntityResolver.fit()</span></code> update the existing index rather than creating a new one from scratch. This means that new objects are added, and objects with existing IDs are updated, but no objects are deleted. If you wish to delete objects, fully recreate the index from scratch by running a clean fit as follows.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">er</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">clean</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Unlike the other NLP components, <em>EntityResolver.dump()</em> and <em>EntityResolver.load()</em> do not do anything since there are no model weights to be saved to disk. Everything needed exists in the Elasticsearch index and the entity mapping files.</p>
</div>
</div>
<div class="section" id="run-the-entity-resolver">
<h2>Run the entity resolver<a class="headerlink" href="#run-the-entity-resolver" title="Permalink to this headline">¶</a></h2>
<p>Once the resolver has been fit, test the entity resolver by passing <code class="docutils literal"><span class="pre">Entity</span></code> objects as follows.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mmworkbench.core</span> <span class="kn">import</span> <span class="n">Entity</span>
<span class="n">er</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Entity</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;gluten free pepperoni pizza&#39;</span><span class="p">,</span> <span class="n">entity_type</span><span class="o">=</span><span class="s1">&#39;dish&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">[{&#39;cname&#39;: &#39;Pepperoni Pizza (Gluten Free)&#39;,</span>
<span class="go">  &#39;id&#39;: &#39;B01D8TCLJ2&#39;,</span>
<span class="go">  &#39;score&#39;: 119.62746,</span>
<span class="go">  &#39;top_synonym&#39;: &#39;gluten free pepperoni pizza&#39;},</span>
<span class="go"> {&#39;cname&#39;: &#39;Margherita Pizza (Gluten Free)&#39;,</span>
<span class="go">  &#39;id&#39;: &#39;B01D8TCRWI&#39;,</span>
<span class="go">  &#39;score&#39;: 38.989628,</span>
<span class="go">  &#39;top_synonym&#39;: &#39;gluten-free margherita pizza&#39;},</span>
<span class="go"> {&#39;cname&#39;: &#39;Barbecued Chicken Pizza (Gluten Free)&#39;,</span>
<span class="go">  &#39;id&#39;: &#39;B01D8TCCK0&#39;,</span>
<span class="go">  &#39;score&#39;: 35.846962,</span>
<span class="go">  &#39;top_synonym&#39;: &#39;gluten-free barbeque chicken pizza&#39;},</span>
<span class="go"> {&#39;cname&#39;: &#39;Plain Cheese Pizza (Gluten Free)&#39;,</span>
<span class="go">  &#39;id&#39;: &#39;B01D8TCJEE&#39;,</span>
<span class="go">  &#39;score&#39;: 35.43069,</span>
<span class="go">  &#39;top_synonym&#39;: &#39;cheese pizza gluten free&#39;},</span>
<span class="go"> {&#39;cname&#39;: &#39;Sausage and Mushroom Pizza (Gluten Free)&#39;,</span>
<span class="go">  &#39;id&#39;: &#39;B01D8TD5T2&#39;,</span>
<span class="go">  &#39;score&#39;: 35.094833,</span>
<span class="go">  &#39;top_synonym&#39;: &#39;gluten-free sausage and mushroom pizza&#39;},</span>
<span class="go"> {&#39;cname&#39;: &#39;Four Cheese White Pizza (Gluten Free)&#39;,</span>
<span class="go">  &#39;id&#39;: &#39;B01D8TD9DO&#39;,</span>
<span class="go">  &#39;score&#39;: 31.833534,</span>
<span class="go">  &#39;top_synonym&#39;: &#39;Four Cheese White Pizza (Gluten Free)&#39;},</span>
<span class="go"> {&#39;cname&#39;: &#39;The Truck Stop Burger&#39;,</span>
<span class="go">  &#39;id&#39;: &#39;B01DWO5N5W&#39;,</span>
<span class="go">  &#39;score&#39;: 28.069,</span>
<span class="go">  &#39;top_synonym&#39;: &#39;gluten free burger&#39;},</span>
<span class="go"> {&#39;cname&#39;: &#39;Pesto with Red Pepper and Goat Cheese (Gluten Free)&#39;,</span>
<span class="go">  &#39;id&#39;: &#39;B01D8TCA48&#39;,</span>
<span class="go">  &#39;score&#39;: 28.018322,</span>
<span class="go">  &#39;top_synonym&#39;: &#39;Pesto with Red Pepper and Goat Cheese (Gluten Free)&#39;},</span>
<span class="go"> {&#39;cname&#39;: &#39;Gluten Free Waffle&#39;,</span>
<span class="go">  &#39;id&#39;: &#39;B01GXT877O&#39;,</span>
<span class="go">  &#39;score&#39;: 27.94693,</span>
<span class="go">  &#39;top_synonym&#39;: &#39;Gluten Free Waffle&#39;},</span>
<span class="go"> {&#39;cname&#39;: &#39;Lamb Platter&#39;,</span>
<span class="go">  &#39;id&#39;: &#39;B01CRF8WAK&#39;,</span>
<span class="go">  &#39;score&#39;: 27.913887,</span>
<span class="go">  &#39;top_synonym&#39;: &#39;gluten free lamb platter&#39;}]</span>
</pre></div>
</div>
<p>Each entry in the list of resolved entities contains:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>canonical name</strong></td>
<td>The name used to refer to the real-world entity.</td>
</tr>
<tr class="row-even"><td><strong>unique ID</strong></td>
<td>The ID as listed in the entity mapping file which should correspond with a Knowledge Base object.</td>
</tr>
<tr class="row-odd"><td><strong>score</strong></td>
<td>A score which indicates the strength of the match. This score is a relative value (higher scores are better). It is not normalized accross all entity types or queries.</td>
</tr>
<tr class="row-even"><td><strong>top synonym</strong></td>
<td>The synonym in the whitelist of this canonical form that most closely matched the user’s query.</td>
</tr>
<tr class="row-odd"><td><strong>sort factor</strong></td>
<td>If the sort factor is provided in the entity mapping file, it is also returned.</td>
</tr>
</tbody>
</table>
<p>The Entity Resolver returns a ranked list of the top ten canonical forms for each recognized entity. Taking the top-ranked value usually works, but in some cases it’s preferable to look at other options in the ranked list. Here are two examples:</p>
<ol class="arabic simple">
<li>When building a browsing functionality in your app, you might want to offer the user a choice of the top three resolved values.</li>
<li>Suppose the user has provided some constraints in a previous query. The entity resolver has no access to this previous context at resolution time, so the top-ranked result may not satisfy previously defined constraints. Here, you may want to look deeper into the ranked list.</li>
</ol>
<p>The next section explains how to handles scenarios like this.</p>
</div>
<div class="section" id="consider-context-aware-entity-resolution">
<h2>Consider context-aware entity resolution<a class="headerlink" href="#consider-context-aware-entity-resolution" title="Permalink to this headline">¶</a></h2>
<p>While the Entity Resolver finds the best-matching canonical values based on text relevance and numeric sort factors, you might sometimes want application-specific constraints to influence how the recognized entities are resolved. These constraints could come from proximity information, business logic, the data model hierarchy, or elsewhere. For instance:</p>
<ul class="simple">
<li>resolve to the dish whose name best matches <code class="docutils literal"><span class="pre">Pad</span> <span class="pre">Thai</span></code>, within a selected restaurant</li>
<li>resolve to the nearest <code class="docutils literal"><span class="pre">Best</span> <span class="pre">Buy</span></code></li>
<li>resolve to the product that best matches <code class="docutils literal"><span class="pre">cotton</span> <span class="pre">long</span> <span class="pre">sleeve</span> <span class="pre">shirts</span></code>, and that is on sale</li>
</ul>
<p>These scenarios are examples of <em>context-aware resolution</em>. Deciding whether context-aware resolution is required, and if so under what circumstances, is important aspect of designing your app.</p>
<p>There are two ways to accomplish context-aware resolution in Workbench:</p>
<blockquote>
<div><ul class="simple">
<li>In your <a class="reference internal" href="../quickstart/04_define_the_dialogue_handlers.html"><span class="doc">dialogue state handlers</span></a>, iterate through the ranked list to find the first entry that satisfies the constraints.</li>
<li>Use the <a class="reference internal" href="kb.html"><span class="doc">Question Answerer</span></a> to do a filtered search against the knowledge base to disambiguate entities with contextual constraints.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="about-the-exact-match-text-similarity-model">
<span id="exact-match"></span><h2>About the Exact Match text similarity model<a class="headerlink" href="#about-the-exact-match-text-similarity-model" title="Permalink to this headline">¶</a></h2>
<p>If you choose not to use Elasticsearch, Workbench provides a simple baseline version of entity resolution. This Exact Match Model only resolves to an object when the text exactly matches a canonical name or synonym. To use the Exact Match Model, add the following to your app config (<code class="docutils literal"><span class="pre">config.py</span></code>) located in the top level of your app folder:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ENTITY_RESOLVER_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;model_type&#39;</span><span class="p">:</span> <span class="s1">&#39;exact_match&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is merely a fall-back option, for when you need to get an end-to-end app running without Elasticsearch. However, this approach is not optimal, and unsuitable for a broad-vocabulary conversational app.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parser.html" class="btn btn-neutral float-right" title="Working with the Language Parser" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="role_classifier.html" class="btn btn-neutral float-left" title="Working with the Role Classifier" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Cisco Systems

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>